# mqttx conn --mqtt-version 3.1.1 -h test.mosquitto.org -p 8883 -l mqtts --insecure
# mqttx sub -t 'testtopic/1234' --mqtt-version 3.1.1 -h test.mosquitto.org -p 8883 -l mqtts --insecure

# https://github.com/esphome/esphome/pull/7501
# external_components:
#   - source: github://esphome/esphome@dev
#     components: [ mqtt ]

mqtt:
  # broker: broker.emqx.io # This server gives many TLS errors. 
  broker: 192.168.81.145
  port: 9993
  client_id: ${name}
  #client_id: 01P00A442000276 #Expiriment if name must match leaf cert sbuject name: https://github.com/espressif/esp-mqtt/issues/84#issuecomment-434408194
  #client_id: thisshoudlbreak
  username: bblp
  password: 12345678
  log_topic:
  discover_ip: false
  discovery: false
  discovery_retain: false
  discovery_prefix:
  use_abbreviations: false
  topic_prefix:   testtopic/5678
  # topic_prefix:
  birth_message:
    topic: # Dont post update to MQTT
    payload: # Dont post update to MQTT
  will_message:
    topic: # Dont post update to MQTT
    payload: # Dont post update to MQTT
  skip_cert_cn_check: true
  certificate_authority: |
    -----BEGIN CERTIFICATE-----
    MIIDZTCCAk2gAwIBAgIUKWdx3jaID5w19t9WtPta0dCdyw4wDQYJKoZIhvcNAQEL
    BQAwQjELMAkGA1UEBhMCQ04xIjAgBgNVBAoMGUJCTCBUZWNobm9sb2dpZXMgQ28u
    LCBMdGQxDzANBgNVBAMMBkJCTCBDQTAeFw0yNDEwMTExNjQ0MzlaFw0zNDEwMDkx
    NjQ0MzlaMEIxCzAJBgNVBAYTAkNOMSIwIAYDVQQKDBlCQkwgVGVjaG5vbG9naWVz
    IENvLiwgTHRkMQ8wDQYDVQQDDAZCQkwgQ0EwggEiMA0GCSqGSIb3DQEBAQUAA4IB
    DwAwggEKAoIBAQDVwBwxkAcnaW2n4bHPFgeK9hR8OpSXb0WGohs6LyA89HjUS+Zp
    t8jsuKlNWgVM7ueE9sPWNV5EOO/F2YNH1NHgq51AjKnllArNd52E439Vo/fFlXSk
    uzI1OZ+HkLPuI/4BXTBSVuNnSWRvbWfByQ0Tf//UH7qCZq/s8TwwZwWiDZONK8SH
    SMd3sEaNCfrfZeael3IS0TcDl9xC8Q1G1kuPk11ioAoU1VRX1uVi5wLnRIOwfvF+
    TxN64t8lGi2A62stcU/9hOs++7tSpWRWEzzp0oDj/HaF2WKo+8qUbbBcH2GLmqyv
    dVEYJkSN9SV7fDmOFi8maV2/5jRGnlrNyCFhAgMBAAGjUzBRMB0GA1UdDgQWBBR9
    aN222y17M0V1R06rZITfj4Z6PjAfBgNVHSMEGDAWgBR9aN222y17M0V1R06rZITf
    j4Z6PjAPBgNVHRMBAf8EBTADAQH/MA0GCSqGSIb3DQEBCwUAA4IBAQBMO7A/CwhO
    pCOKeh7cUQNEtlGSqiXnDv7YDX2ltMM/lei9ebfaxqkUgqk2tVvrDhusNmIypyAX
    zZtH+MQvh7G0JjETXiIVcC4Lx0sErImntef0n/UvJTq/ynnSCqZVTA5yh8gC4vHy
    0GnfXV/VZtC7ayqF7ykUux1dGbUBPhGILUehDR0HEeiFkZSLStdUH5kZJld+fzZw
    oXJhs5pxzdkGJ0ls65MduiocCbBVH/WkyHhHAt2yFawV4aYBK3iTZ9YXfWAl9fVZ
    tFuJv81M6Usv/rjLApoz2XYg6kZbI4Ja+KnNu0AlYjhwKZrs3XszwCnkrj+zVxog
    Af1z4aUP7/PC
    -----END CERTIFICATE-----
  # clean_session: true #https://github.com/esphome/esphome/pull/7501 #(requires dev branch)
  #TODO: set clean session flag
  #TODO: increase keep alive from 15 seconds
  # on_connect:
  #   # then:
  #   #   - output.turn_on: onboard_led
  #   #   - logger.log: "Connected to Bambu Printer"
  # on_disconnect:
  #   # then:
  #   #   - logger.log: "Disconnected from Bambu Printer"
  # on_message:
  #   # - topic: "test/1234"
  #   #   then:
  #   #     - logger.log: "Received message on topic: test/1234"

# text_sensor:
#   - platform: mqtt_subscribe
#     name: "Bambu Printer Status"
#     id: bambu_printer_status
#     # topic: "testtopic/1234/status"
#     topic: 
#     state_topic:
#     on_value:
#       then:
#         - logger.log:
#             format: "Received status: %s"
#             args: ["x.c_str()"]
#             level: INFO

logger:
  level: VERBOSE
  logs:
    mqtt.component: VERBOSE
    mqtt.client: VERBOSE

# sensor:
#   - platform: mqtt_subscribe
#     name: "Data from topic"
#     id: mysensor
#     topic: testtopic/1234
#     state_topic: # Don't post update to MQTT
